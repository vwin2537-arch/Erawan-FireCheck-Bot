<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ app_name }} - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-900">
    <div class="max-w-7xl mx-auto px-4 py-8">
        <header class="flex justify-between items-center mb-12">
            <div>
                <h1 class="text-3xl font-bold text-red-600">üî• {{ app_name }}</h1>
                <p class="text-gray-500">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏∏‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
            </div>
            <div class="space-x-4">
                <button onclick="checkNow()" id="checkBtn"
                    class="bg-red-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-700 transition">
                    ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="text-gray-500 text-sm font-semibold mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <div class="flex items-center">
                    <span class="h-3 w-3 rounded-full bg-green-500 mr-2"></span>
                    <span class="text-xl font-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</span>
                </div>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="text-gray-500 text-sm font-semibold mb-2">‡∏à‡∏∏‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                <div id="todayCount" class="text-3xl font-bold text-red-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="text-gray-500 text-sm font-semibold mb-2">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div id="lastCheck" class="text-xl font-bold text-gray-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
        </div>

        <section class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="px-8 py-6 border-b border-gray-50 flex justify-between items-center">
                <h2 class="text-xl font-bold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∏‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô)</h2>
                <span class="text-sm text-gray-400">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 text-gray-500 text-sm font-semibold">
                        <tr>
                            <th class="px-8 py-4">‡∏û‡∏¥‡∏Å‡∏±‡∏î (Lat, Lon)</th>
                            <th class="px-8 py-4">‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö</th>
                            <th class="px-8 py-4">‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°</th>
                            <th class="px-8 py-4">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô</th>
                            <th class="px-8 py-4">FRP (MW)</th>
                        </tr>
                    </thead>
                    <tbody id="hotspotTable" class="divide-y divide-gray-50">
                        <!-- Data rows will be injected here -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        async function loadData() {
            try {
                const response = await fetch('/api/hotspots/today');
                const hotspots = await response.json();

                document.getElementById('todayCount').innerText = `${hotspots.length} ‡∏à‡∏∏‡∏î`;

                const table = document.getElementById('hotspotTable');
                table.innerHTML = hotspots.length > 0
                    ? hotspots.map(h => `
                        <tr>
                            <td class="px-8 py-4 font-mono text-sm">${h.latitude.toFixed(4)}, ${h.longitude.toFixed(4)}</td>
                            <td class="px-8 py-4">${h.acq_time.substring(0, 5)} ‡∏ô. (${h.acq_date})</td>
                            <td class="px-8 py-4"><span class="bg-blue-50 text-blue-600 px-2 py-1 rounded text-xs font-bold">${h.satellite}</span></td>
                            <td class="px-8 py-4">${h.confidence}</td>
                            <td class="px-8 py-4 font-semibold">${h.frp.toFixed(2)}</td>
                        </tr>
                    `).join('')
                    : '<tr><td colspan="5" class="px-8 py-12 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏à‡∏∏‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ó‡∏µ‡πà</td></tr>';

                // Load last log
                const logRes = await fetch('/api/logs?limit=1');
                const logs = await logRes.json();
                if (logs.length > 0) {
                    const log = logs[0];
                    const date = new Date(log.checked_at);
                    document.getElementById('lastCheck').innerText = date.toLocaleTimeString('th-TH');
                } else {
                    document.getElementById('lastCheck').innerText = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        async function checkNow() {
            const btn = document.getElementById('checkBtn');
            const originalText = btn.innerText;
            btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';
            btn.disabled = true;
            btn.classList.add('opacity-50');

            try {
                const response = await fetch('/api/check-now', { method: 'POST' });
                const result = await response.json();
                alert(`‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n\n- ‡∏û‡∏ö‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°: ${result.new_hotspots} ‡∏à‡∏∏‡∏î\n- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${result.hotspots_found} ‡∏à‡∏∏‡∏î`);
                loadData();
            } catch (error) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö');
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
                btn.classList.remove('opacity-50');
            }
        }

        loadData();
        setInterval(loadData, 60000); // 1 min auto-refresh
    </script>
</body>

</html>